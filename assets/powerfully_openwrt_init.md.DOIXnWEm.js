import{_ as i,c as a,o as t,aF as n,aH as l}from"./chunks/framework.oEGEVMzI.js";const g=JSON.parse('{"title":"初始化","description":"","frontmatter":{},"headers":[],"relativePath":"powerfully/openwrt/init.md","filePath":"powerfully/openwrt/init.md"}'),h={name:"powerfully/openwrt/init.md"};function p(e,s,k,r,d,F){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="初始化" tabindex="-1">初始化 <a class="header-anchor" href="#初始化" aria-label="Permalink to “初始化”">​</a></h1><h2 id="备份" tabindex="-1">备份 <a class="header-anchor" href="#备份" aria-label="Permalink to “备份”">​</a></h2><ul><li>启动脚本 <code>/etc/rc.local</code></li><li>定时任务 <code>/etc/crontabs/root</code></li><li>备份 <code>/root/*</code></li><li>备份脚本 <code>/root/shell/tools/bak.sh</code></li></ul><h2 id="固件" tabindex="-1">固件 <a class="header-anchor" href="#固件" aria-label="Permalink to “固件”">​</a></h2><blockquote><p>记得备份安装的固件</p></blockquote><ul><li><a href="https://github.com/lqzhgood/openwrt-ax1800pro-ci" target="_blank" rel="noreferrer">JDCloud-ax1800pro</a></li><li><a href="https://firmware-selector.immortalwrt.org/" target="_blank" rel="noreferrer">immortalwrt</a></li></ul><h2 id="恢复" tabindex="-1">恢复 <a class="header-anchor" href="#恢复" aria-label="Permalink to “恢复”">​</a></h2><h3 id="软件包" tabindex="-1">软件包 <a class="header-anchor" href="#软件包" aria-label="Permalink to “软件包”">​</a></h3><details><summary>opkg apk 命令对照表</summary><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OpenWrt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> recently</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> switched</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;apk&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manager!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OPKG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           APK</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Equivalent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Description</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> del</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Upgrade</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   List</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> contents</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list-installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            List</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> installed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lists</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> opkg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Search</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ------------------------------------------------------------------</span></span></code></pre></div></details><table tabindex="0"><thead><tr><th>ipk</th><th>描述</th><th>依赖</th></tr></thead><tbody><tr><td>luci-theme-bootstrap</td><td>经典皮肤</td><td></td></tr><tr><td>luci-i18n-zerotier-zh-cn</td><td>zerotier</td><td></td></tr><tr><td>luci-i18n-nfs-zh-cn</td><td>nfs 挂载</td><td></td></tr><tr><td><a href="https://github.com/animegasan/luci-app-wolplus/releases" target="_blank" rel="noreferrer">luci-app-wolplus</a></td><td>wol 唤醒</td><td></td></tr><tr><td>luci-i18n-vlmcsd-zh-cn</td><td>kms 激活</td><td></td></tr><tr><td><a href="https://github.com/sirpdboy/luci-app-netspeedtest" target="_blank" rel="noreferrer">luci-app-netspeedtest</a></td><td>网速测试</td><td></td></tr><tr><td>htop</td><td>任务管理器</td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td>jq-full / jq</td><td>json 解析</td><td><code>/root/shell/lib/dnspod.sh</code></td></tr><tr><td>tar</td><td>全功能压缩</td><td><code>/root/shell/tools/bak.sh</code></td></tr><tr><td>curl</td><td>请求</td><td><code>/root/shell/agent/cpu.sh</code></td></tr><tr><td>msmtp</td><td>邮件</td><td><code>/root/update_ddns.sh</code></td></tr></tbody></table><h3 id="设置" tabindex="-1">设置 <a class="header-anchor" href="#设置" aria-label="Permalink to “设置”">​</a></h3><ul><li>设置 wan、wifi</li><li>@<a href="./zerotier/">Zerotier</a></li><li>初始化脚本 <code>/root/shell/tools/init.sh</code></li></ul><h3 id="dns" tabindex="-1">DNS <a class="header-anchor" href="#dns" aria-label="Permalink to “DNS”">​</a></h3><h4 id="关闭重定向保护" tabindex="-1">关闭重定向保护 <a class="header-anchor" href="#关闭重定向保护" aria-label="Permalink to “关闭重定向保护”">​</a></h4><p><img src="`+l+`" alt="dns-allow-wan-lanip"></p><details><summary>打开后使用 wan 口地址无法访问 lan 地址</summary><p>如 <code>wan:1.1.1.1</code> -&gt; <code>lan:192.168.1.1</code>， 输入 <code>1.1.1.1</code> 的时候会转为 <code>192.168.1.1</code> 即抛弃</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>想把*.foo.lan 都解析到 foo 对应的机器上，但是 dnsmasq 没有实现*的解析，退而求其次。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>在阿里云的 dns 平台，把</span></span>
<span class="line"><span></span></span>
<span class="line"><span>*.foo.example.org 都解析到 foo 机器的 lanip 上</span></span>
<span class="line"><span></span></span>
<span class="line"><span>表现：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>在外网访问 bar.foo.example.org 是正确的</span></span>
<span class="line"><span>在内网得不到解析结果</span></span>
<span class="line"><span>试了几次，只要解析到 192.168.0.0/16 10.0.0.0/8 的都解析不到</span></span>
<span class="line"><span>但是 local 的是可以的，127.0.0.0/8 是没问题的</span></span>
<span class="line"><span>求点解是哪个配置没做对</span></span></code></pre></div><p><a href="https://www.v2ex.com/t/846507" target="_blank" rel="noreferrer">https://www.v2ex.com/t/846507</a></p></details>`,16)])])}const c=i(h,[["render",p]]);export{g as __pageData,c as default};
