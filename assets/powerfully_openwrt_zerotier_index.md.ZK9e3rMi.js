import{_ as s,c as i,o as e,aF as l,aI as t,aJ as n,aK as r,aL as h,aM as p,aN as d,aO as c,aP as o}from"./chunks/framework.BmcaWGs9.js";const y=JSON.parse('{"title":"Zerotier","description":"","frontmatter":{},"headers":[],"relativePath":"powerfully/openwrt/zerotier/index.md","filePath":"powerfully/openwrt/zerotier/index.md"}'),k={name:"powerfully/openwrt/zerotier/index.md"};function g(b,a,m,f,u,_){return e(),i("div",null,[...a[0]||(a[0]=[l('<h1 id="zerotier" tabindex="-1">Zerotier <a class="header-anchor" href="#zerotier" aria-label="Permalink to “Zerotier”">​</a></h1><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to “配置”">​</a></h2><h1 id="config" tabindex="-1"><img src="'+t+'" alt="config"> <a class="header-anchor" href="#config" aria-label="Permalink to “”">​</a></h1><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>IP 动态伪装： 如果从 123.123.123.123(192.168.40.1):8888 -&gt; 192.168.20.1:80 就需要开</p></div><h3 id="允许桥接" tabindex="-1">允许桥接 <a class="header-anchor" href="#允许桥接" aria-label="Permalink to “允许桥接”">​</a></h3><p><img src="'+n+'" alt="bridging"></p><h2 id="内网互通" tabindex="-1">内网互通 <a class="header-anchor" href="#内网互通" aria-label="Permalink to “内网互通”">​</a></h2><h3 id="新增接口" tabindex="-1">新增接口 <a class="header-anchor" href="#新增接口" aria-label="Permalink to “新增接口”">​</a></h3><p><img src="'+r+'" alt="interface1"></p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>这里配防火墙的时候才会显示</p></div><p><img src="'+h+'" alt="config-firewall"></p><h3 id="防火墙" tabindex="-1">防火墙 <a class="header-anchor" href="#防火墙" aria-label="Permalink to “防火墙”">​</a></h3><p><img src="'+p+'" alt="firewall"></p><h4 id="防火墙规则-允许直连" tabindex="-1">防火墙规则-允许直连 <a class="header-anchor" href="#防火墙规则-允许直连" aria-label="Permalink to “防火墙规则-允许直连”">​</a></h4><p><img src="'+d+`" alt="firewall-rule"></p><h2 id="命令" tabindex="-1">命令 <a class="header-anchor" href="#命令" aria-label="Permalink to “命令”">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看是否直连</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> peers</span></span></code></pre></div><h2 id="dns-互联" tabindex="-1">DNS 互联 <a class="header-anchor" href="#dns-互联" aria-label="Permalink to “DNS 互联”">​</a></h2><p>异地子网已经打通，还剩下 DNS 的问题， 如有以下设备</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>A 子网有  xps -&gt; 192.168.20.10</span></span>
<span class="line"><span>B 子网有  phone -&gt; 192.168.30.10</span></span></code></pre></div><p>期望无论在哪个子网，输入 phone 即可访问设备，因为 手机、笔记本等设备在不同子网 ip 是不同的</p><h3 id="方案-1-中央-dns-服务器" tabindex="-1">方案 1 中央 DNS 服务器 <a class="header-anchor" href="#方案-1-中央-dns-服务器" aria-label="Permalink to “方案 1 中央 DNS 服务器”">​</a></h3><p>无论谁做 dns 服务器断连后风险都很大... 废弃</p><h3 id="方案-2-异地查询" tabindex="-1">方案 2 异地查询 <a class="header-anchor" href="#方案-2-异地查询" aria-label="Permalink to “方案 2 异地查询”">​</a></h3><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>输入 <code>phone</code> 的时候 dnsmasq 会自动添加 <code>.lan</code> 本地域名。</p></div><p>如果不同子网约定不同的域名后缀，那么可以根据域名后缀将 dns 请求发给对应的子网网关解析，查询后返回 ip 即可，那么就可以做到自动发现，无需维护静态 DHCP。</p><div class="danger custom-block"><p class="custom-block-title custom-block-title-default">DANGER</p><p>不同子网必须约定不同的本地域名，如果都使用相同的 <code>.lan</code> 会造成死循环。</p></div><h4 id="允许非本地查询" tabindex="-1">允许非本地查询 <a class="header-anchor" href="#允许非本地查询" aria-label="Permalink to “允许非本地查询”">​</a></h4><div class="language-plain"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>uci set dhcp.@dnsmasq[0].localservice=&#39;0&#39;  # 允许非本地查询</span></span>
<span class="line"><span>uci commit</span></span>
<span class="line"><span>service dnsmasq restart</span></span></code></pre></div><p><img src="`+c+`" alt="dns-allow-not-local"></p><h4 id="lan-转发其他服务器" tabindex="-1">lan 转发其他服务器 <a class="header-anchor" href="#lan-转发其他服务器" aria-label="Permalink to “lan 转发其他服务器”">​</a></h4><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uci add_list dhcp.@dnsmasq[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/lan/192.168.30.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  # 30网段OpenWrt的ZeroTier IP或LAN </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uci commit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">service dnsmasq restart</span></span></code></pre></div><p><img src="`+o+'" alt="dns-server"></p>',33)])])}const P=s(k,[["render",g]]);export{y as __pageData,P as default};
